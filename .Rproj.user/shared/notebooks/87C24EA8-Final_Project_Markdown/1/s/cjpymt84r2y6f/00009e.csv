"0","# calculated the subtotal sum of all money ( in USD) 2000-2014 by country. "
"0","subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( ""Total Sum for Country""= sum(sum.usd))"
"0","# the subtotal USD per sector per year"
"0","subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd)) "
"0","top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 10000000000) %>%   filter(!(crs_sector_name %in% c(""Unallocated / Unspecified"", ""Other Multisector""))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)  "
"2","Joining, by = c(""crs_sector_name"", ""total.per.sector"")
"
"0","# ""Unallocated / Unspecified"")"
"0","                                                                                    bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector < 10000000000 | crs_sector_name %in% c(""Unallocated / Unspecified"", ""Other Multisector"")) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( sum.usd = sum(sum.usd)) %>% mutate(crs_sector_name = ""Other Projects"")"
"2","Joining, by = c(""crs_sector_name"", ""total.per.sector"")
"
"0","                                                                                    "
"0","  full.sectors <- full_join(top.sectors, bot.sectors)                                                                                 "
"2","Joining, by = c(""crs_sector_name"", ""year"", ""sum.usd"")
"
"0"," l <- list("
"0","  font = list("
"0","    family = ""sans-serif"","
"0","    size = 12,"
"0","    color = ""#000""),"
"0","  bgcolor = ""#E2E2E2"","
"0","  bordercolor = ""#FFFFFF"","
"0","  borderwidth = 2)"
"0"," "
"0"," x <- list( title= ""Years"", nticks=20,"
"0","  font = list("
"0","    family = ""sans-serif"","
"0","    size = 12,"
"0","    color = ""#000""),"
"0","  bgcolor = ""#E2E2E2"","
"0","  bordercolor = ""#FFFFFF"","
"0","  borderwidth = 2) "
"0"," "
"0","  y <- list( title= ""Amount of Aid (in billions of USD)"","
"0","  font = list("
"0","    family = ""sans-serif"","
"0","    size = 12,"
"0","    color = ""#000""),"
"0","  bgcolor = ""#E2E2E2"","
"0","  bordercolor = ""#FFFFFF"","
"0","  borderwidth = 2) "
"0"," "
"0","                                                                                                                 "
"0","tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = ""bar"", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = ""stack"", legend = l, title= ""Aid by Sectors"", xaxis= x, yaxis= y) "
"0","tmp"
"2","n too large, allowed maximum for palette Set2 is 8
Returning the palette you asked for with that many colors
"
"2","n too large, allowed maximum for palette Set2 is 8
Returning the palette you asked for with that many colors
"
