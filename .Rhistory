)
wordcloud <- quanteda::textplot_wordcloud(myDfm,
min.freq = 500,
random.order = FALSE,
rot.per = .25,
colors = RColorBrewer::brewer.pal(8,"Dark2"))
wordcloud
countries.data <- as.data.frame(table(china.aid$recipient_condensed))
matched <- joinCountryData2Map(countries.data, joinCode="NAME", nameJoinColumn="Var1", verbose=FALSE)
mapCountryData(matched, nameColumnToPlot="Freq", mapTitle="Number of Projects",catMethod = "pretty", colourPalette = "heat")
countries.data <- as.data.frame(table(china.aid$recipient_condensed))
matched <- joinCountryData2Map(countries.data, joinCode="NAME", nameJoinColumn="Var1", verbose=FALSE)
mapCountryData(matched, nameColumnToPlot="Freq", mapRegion = "Africa", mapTitle="Number of Projects", catMethod = "pretty", colourPalette = "heat")
selected_sectors<- as.data.frame(table(china.aid$crs_sector_name)) %>% filter(Freq >100) %>% distinct(Var1) %>% as.vector()
sectors_by_years <- as.data.frame(table((china.aid$crs_sector_name), china.aid$year)) %>% filter(Freq>10)
# order legend by frequency, start with only top 3 selected.
# BY MONEY not by number or projects.
# add the dimension of region not just whole world.
sectors_by_years %>% plot_ly(x = ~Var2, y = ~Freq, color = ~Var1)
tmp <-as.data.frame(table(china.aid$flow, china.aid$year))
aidtype <-plot_ly(tmp) %>% add_trace(data = tmp, type = "bar", x= tmp$Var2, y= tmp$Freq, color = tmp$Var1) %>%  layout(barmode = "stack")
aidtype
###Further Ideas
# Make map based on not number or projects but on total money going in
# Merge with Data from GDP growth of different countries and do regression analysis?
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year)
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% mutate(sum.usd, total.year = (sum(sum.usd)))
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  mutate()
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% mutate(sum.usd, total.year = (sum(sum.usd)))
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%
subtotal.countries %>%  group_by(year) %>% mutate(year, sum.year= sum(sum.usd))
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year)
subtotal.countries %>%  group_by(year) %>% mutate(year, sum.year= sum(sum.usd))
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year)
subtotal.countries %>%  group_by(year) %>% mutate(year, sum_year= sum(sum.usd))
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year)
subtotal.countries %>%  group_by(year) %>% mutate(sum.usd, sum_year= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% mutate(sum.usd, total.year = (sum(sum.usd)))
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year)
subtotal.countries %>%  group_by(recipient_condensed) %>% mutate( sum_year= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% mutate(sum.usd, total.year = (sum(sum.usd)))
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(subtotal.countries)
tmp <- subtotal.countries %>%  group_by(recipient_condensed) %>% mutate( sum_year= sum(sum.usd))
View(tmp)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( total.country= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% mutate(sum.usd, total.year = (sum(sum.usd)))
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(subtotal.countries)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( total.usd.country= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.usd.sector= sum(sum.usd))
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(subtotal.sectors)
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( "Sum of All Years per Sector"= sum(sum.usd))
View(subtotal.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( "Total Sum for Sector"= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>% unique()
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(top.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( "Total Sum for Sector"= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>% unique() %>% arrange(desc("Total Sum for Sector"))
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>% unique() %>% arrange(desc(total.per.sector))
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(top.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>% unique() %>% arrange(desc(total.per.sector)) %>% head(10)
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(top.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>% unique() %>% arrange(desc(total.per.sector)) %>% head(11)
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>% unique() %>% arrange(desc(total.per.sector)) %>% bottom(5)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>% unique() %>% arrange(desc(total.per.sector)) %>%tail(5)
head(11) %>%
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
View(top.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>% unique() %>% arrange(desc(total.per.sector)) %>% (tail(20) %>% group())
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd)
head(11) %>%
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
View(top.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique()
head(11) %>%
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%   head(11) %>%
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%   head(11)
tmp <- plot_ly(subtotal.sectors) %>%  add_trace(data = subtotal.sectors, type = "bar", x= subtotal.sectors$year, y= subtotal.sectors$sum.usd, color = subtotal.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(top.sectors)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(11)
View(top.sectors)
View(top.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(11) %>% select(-total.per.sector)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(11) %>% select(-total.per.sector) %>% semi_join(subtotal.sectors)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(top.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(11) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(top.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(12) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(12)
View(top.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(top.sectors)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector))
View(bot.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(bot.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(bot.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors) %>% select(-total.per.sector) %>% group_by(year)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(bot.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors) %>% select(-total.per.sector) %>% group_by(year) %>% summarize(sum(sum.usd))
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(bot.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors) %>% select(-total.per.sector) %>% group_by(year) %>% summarize(sum(sum.usd)) %>%  mutate("Other Projects")
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(bot.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors) %>% select(-total.per.sector) %>% group_by(year) %>% summarize(sum(sum.usd)) %>%  mutate(crs_sector_name = "Other Projects")
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(bot.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors) %>% select(-total.per.sector) %>% group_by(year) %>% summarize(sum(sum.usd)) %>%  mutate(crs_sector_name = "Other Projects") %>% full_join(top.sectors)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(bot.sectors)
View(bot.sectors)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors) %>% select(-total.per.sector) %>% group_by(year) %>% summarize(sum(sum.usd)) %>%  mutate(crs_sector_name = "Other Projects")
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
View(top.sectors)
View(bot.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize(sum(sum.usd)) %>%  mutate(crs_sector_name = "Other Projects")
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(bot.sectors)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( sum(sum.usd))
View(bot.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( total.per.sector = sum(sum.usd))
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(bot.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% select(-total.per.sector) %>% left_join(subtotal.sectors)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( total.per.sector = sum(sum.usd)) %>% mutate(crs_sector_name = "Other Projects")
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( total.per.sector = sum(sum.usd)) %>% mutate(crs_sector_name = "Other Projects")
View(bot.sectors)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
View(top.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( total.per.sector = sum(sum.usd)) %>% mutate(crs_sector_name = "Other Projects")
full.sectors <- full_join(top.sectors, bot.sectors)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(full.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( sum.usd = sum(sum.usd)) %>% mutate(crs_sector_name = "Other Projects")
full.sectors <- full_join(top.sectors, bot.sectors)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(full.sectors)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  (head(13) -"Unallocated / Unspecified") %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% filter(crs.sector.name != c("Other Multisector", "Unallocated / Unspecified")) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>%  head(13) %>% filter(crs_sector_name != c("Other Multisector", "Unallocated / Unspecified")) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector >= 60000000) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% tail(24-13) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( sum.usd = sum(sum.usd)) %>% mutate(crs_sector_name = "Other Projects")
full.sectors <- full_join(top.sectors, bot.sectors)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
View(top.sectors)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector >= 60000000) %>%   filter(crs_sector_name != c("Other Multisector", "Unallocated / Unspecified")) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector >= 60000000) %>%   filter(crs_sector_name != "Other Multisector") %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector >= 60000000) %>%   filter(crs_sector_name != "Unallocated / Unspecified") %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
View(top.sectors)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector <= 60000000 | crs_sector_name= "Unallocated / Unspecified" ) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( sum.usd = sum(sum.usd)) %>% mutate(crs_sector_name = "Other Projects")
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector < 60000000 | crs_sector_name= "Unallocated / Unspecified" ) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( sum.usd = sum(sum.usd)) %>% mutate(crs_sector_name = "Other Projects")
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector < 60000000 | crs_sector_name == "Unallocated / Unspecified" ) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( sum.usd = sum(sum.usd)) %>% mutate(crs_sector_name = "Other Projects")
View(bot.sectors)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 60000000) %>%   filter(crs_sector_name != "Unallocated / Unspecified") %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
full.sectors <- full_join(top.sectors, bot.sectors)
View(full.sectors)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 60000000) %>%   filter(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector")) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
View(top.sectors)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 60000000) %>%   filter(!(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector"))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector < 60000000 | crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector")) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( sum.usd = sum(sum.usd)) %>% mutate(crs_sector_name = "Other Projects")
View(bot.sectors)
View(bot.sectors)
View(top.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 60000000) %>%   filter(!(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector"))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
# "Unallocated / Unspecified")
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector < 60000000 | crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector")) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( sum.usd = sum(sum.usd)) %>% mutate(crs_sector_name = "Other Projects")
full.sectors <- full_join(top.sectors, bot.sectors)
tmp <- plot_ly(top.sectors) %>%  add_trace(data = top.sectors, type = "bar", x= top.sectors$year, y= top.sectors$sum.usd, color = top.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 600000000) %>%   filter(!(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector"))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
View(top.sectors)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 674188719) %>%   filter(!(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector"))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 6674188719) %>%   filter(!(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector"))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
View(top.sectors)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 600000000) %>%   filter(!(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector"))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 650000000) %>%   filter(!(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector"))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 650000000) %>%   filter(!(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector"))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 6650000000) %>%   filter(!(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector"))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 100000000) %>%   filter(!(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector"))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 1000000000) %>%   filter(!(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector"))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 10000000000) %>%   filter(!(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector"))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
View(top.sectors)
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 10000000000) %>%   filter(!(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector"))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
# "Unallocated / Unspecified")
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector < 10000000000 | crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector")) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( sum.usd = sum(sum.usd)) %>% mutate(crs_sector_name = "Other Projects")
full.sectors <- full_join(top.sectors, bot.sectors)
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack")
tmp
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l)
l <- list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#E2E2E2",
bordercolor = "#FFFFFF",
borderwidth = 2)
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l)
tmp
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid")
tmp
title='x Axis',
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid", xaxis=dict(
title="x Axis"))
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid", xaxis="X axis")
tmp
tmp
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid")
tmp
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid", xaxis= "AAAAA")
tmp
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid", xaxis= "AAAAA")
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectorsyear, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid")
(
showgrid =
F ,
(
showgrid =F,
axis_template <- list( showgrid =F,zeroline =F, nticks = 20, showline =T, title = "AXIS", mirror = all )
axis_template <- list( showgrid =F,zeroline =F, nticks = 20, showline =T, title = "AXIS" )
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectorsyear, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid", axaxis= axis_template)
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors.year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid", axaxis= axis_template)
tmp
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid", axaxis= axis_template)
tmp
axis_template <- list( showgrid =F,zeroline =F, nticks = 20, showline =T, title = "Years" )
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid by Sectors", axaxis= axis_template)
tmp
x <- list( title= "Years",
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#E2E2E2",
bordercolor = "#FFFFFF",
borderwidth = 2)
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid by Sectors", xaxis= x)
tmp
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid by Sectors", xaxis= x, yaxis=y)
y <- list( title= "Amount of Aid (in billions of USD)",
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#E2E2E2",
bordercolor = "#FFFFFF",
borderwidth = 2)
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid by Sectors", xaxis= x, yaxis= y)
tmp
x <- list( title= "Years", nticks=50,
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#E2E2E2",
bordercolor = "#FFFFFF",
borderwidth = 2)
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid by Sectors", xaxis= x, yaxis= y)
tmp
# calculated the subtotal sum of all money ( in USD) 2000-2014 by country.
subtotal.countries <- china.aid %>%  select(recipient_condensed, year, usd_current) %>%  arrange(recipient_condensed) %>% group_by(recipient_condensed, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(recipient_condensed, year) %>%  group_by(recipient_condensed) %>% mutate( "Total Sum for Country"= sum(sum.usd))
# the subtotal USD per sector per year
subtotal.sectors <- china.aid %>%  select(crs_sector_name, year, usd_current) %>%  arrange(crs_sector_name) %>% group_by(crs_sector_name, year) %>% mutate(sum.usd= sum(usd_current, na.rm= T)) %>% select(-usd_current) %>% unique() %>%arrange(crs_sector_name, year) %>% group_by(crs_sector_name) %>% mutate( total.per.sector= sum(sum.usd))
top.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector > 10000000000) %>%   filter(!(crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector"))) %>%  left_join(subtotal.sectors) %>%  select(-total.per.sector)
# "Unallocated / Unspecified")
bot.sectors <- subtotal.sectors %>%  select(-year, -sum.usd) %>%  unique() %>%  arrange(desc(total.per.sector)) %>% filter(total.per.sector < 10000000000 | crs_sector_name %in% c("Unallocated / Unspecified", "Other Multisector")) %>% left_join(subtotal.sectors) %>% group_by(year) %>% summarize( sum.usd = sum(sum.usd)) %>% mutate(crs_sector_name = "Other Projects")
full.sectors <- full_join(top.sectors, bot.sectors)
l <- list(
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#E2E2E2",
bordercolor = "#FFFFFF",
borderwidth = 2)
x <- list( title= "Years", nticks=20,
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#E2E2E2",
bordercolor = "#FFFFFF",
borderwidth = 2)
y <- list( title= "Amount of Aid (in billions of USD)",
font = list(
family = "sans-serif",
size = 12,
color = "#000"),
bgcolor = "#E2E2E2",
bordercolor = "#FFFFFF",
borderwidth = 2)
tmp <- plot_ly(full.sectors) %>%  add_trace(data = full.sectors, type = "bar", x= full.sectors$year, y= full.sectors$sum.usd, color = full.sectors$crs_sector_name) %>%  layout(barmode = "stack", legend = l, title= "Aid by Sectors", xaxis= x, yaxis= y)
tmp
View(subtotal.countries)
